<!DOCTYPE html>
<html lang="en" >

<head>
	<meta charset="UTF-8">
	<title>Marathon</title>
  
	<script type='text/javascript' src='./js/external/jquery-2.1.4.min.js'></script>
	<script type='text/javascript' src='./js/external/htmlCanvas.js'></script> 
	<script type='text/javascript' src='./js/layout.js'></script> 

	<link rel="stylesheet" href="./css/buttons.css" rel="stylesheet">

	<link rel="stylesheet" href="./css/demo.css" rel="stylesheet">
  
</head>

	<body>
		
		<script>

			
			function Header() {
			
				var that = htmlCanvas.widget();
				
				that.renderOn = function(html) {
					html.h1("Marathon");
				}
				
				return that
			}

			function Browser() {
			
				var that = htmlCanvas.widget();
				
				that.renderOn = function(html) {
					sidebar = html.div().addClass("sidebar").asJQuery();	
					nav = html.div().addClass("nav").asJQuery();
					nav.appendTo(sidebar);
					html.span("Start").addClass("page").click(function(){showStart()}).asJQuery().appendTo(nav);
					html.span("Atomic").click(function(){showAtomicMenu($(this))}).asJQuery().appendTo(nav);
					html.div().setAttribute('id', 'container')
				}
				
				function showStart() {
				
				}

				
				function showAtomicMenu(item) {
					if(!$(item.next()).hasClass('nav')) {
						AtomicMenu().appendTo(nav)
					}
				}
								
				return that
			}
	
			function AtomicMenu() {
			
				var that = htmlCanvas.widget();
				var nav;
				
				that.renderOn = function(html) {
					nav = html.div().addClass("nav").asJQuery();
					html.span("CSS").click(function(){showCssMenu(nav)}).asJQuery().appendTo(nav);
				}
				
				function showCssMenu(nav) {
					if(isClosed()) {
						CssMenu(nav).appendTo(nav);
						nav.addClass("opened")
					}
				}

				function isClosed() {
					return !nav.hasClass('opened')
				}
				
				return that
			}
	
			function CssMenu(nav) {
			
				var that = htmlCanvas.widget();
				
				that.renderOn = function(html) {
					html.span("Buttons").addClass("page").click(function(){showButtons()});
					html.span("Layout").addClass("page").click(function(){showLayout()})
				}
					
				function resetContainer() {
					container = $('#container');
					container.html('');
				}

				function showButtons() {
					resetContainer();	
					Buttons().appendTo(container);
				}
				
				function showLayout() {
					resetContainer();	
					Layouts().appendTo(container);
				}
			
				return that
			}
			
			function Layouts() {
			
				var that = htmlCanvas.widget();
				var isAiry = false;
				var count = 1;

				that.renderOn = function(html) {
					panel = html.div().addClass('panel').asJQuery();
					
					html.span('Box number :').addClass("box b-4").asJQuery().appendTo(panel);
					
					select = html.select().addClass("box b-4").asJQuery();
					select.change(function () {count = event.target.value; generateLayouts()});
					select.appendTo(panel);

					html.div().setAttribute("id", "builder");
					var i = 1;
					while(i<13) {
						html.option(i.toString()).setAttribute("value", i).asJQuery().appendTo(select);
						i++
					}

					html.span('Is airy :').addClass("box b-4").asJQuery().appendTo(panel);
					select = html.select().addClass("box b-4").asJQuery();
					select.change(function () {isAiry = event.target.value != false; generateLayouts()});
					select.appendTo(panel);

					html.option('no').setAttribute("value", 0).asJQuery().appendTo(select);
					html.option('yes').setAttribute("value", 1).asJQuery().appendTo(select);

					generateLayouts(1)
				}
				
				function generateLayouts() {
					$("#builder").html("")
					Builder(count, isAiry).appendTo($("#builder"))
				}

				return that
			}
			
			function Builder(number, isAiry){
				
				var that = htmlCanvas.widget();
				
				that.renderOn = function(html) {
					var i = 0;
					lite = false;
					while(i<number) {
						css = 'box b-' + number;
						if(isAiry) {
							css += ' airy';
						}
						code = html.span(css).asJQuery();
						if(lite) {
							css +=' dark';
						}
						lite = !lite;
						box = html.div().addClass(css).asJQuery();
						code.appendTo(box);
						if(number>1 && number<6) {
							buttons = html.div().addClass("buttons").asJQuery();
							buttons.appendTo(box);
							button = html.button().addClass("default").asJQuery();
							button.html("&#8614; &#8612;");
							button.click(function () {decrease($(this))});
							button.appendTo(buttons);
							button = html.button().addClass("primary").asJQuery();
							button.html("&#8596;");
							button.click(function () {increase($(this))});
							button.appendTo(buttons);
						}
						i++	
					}
				}
				
				function increase(button) {
					box = button.parent().parent();
					css = box.attr("class");
					level = new Number(css.split("b-")[1][0]);
					if(css.indexOf("w-") != -1) {
						weight = new Number(css.split("w-")[1][0]);
					} else {
						weight = 1;
					}
					boxes = box.siblings();
					for(var i=0; i<boxes.length; i++) {
						element = $(boxes[i]);
						css = element.attr("class");
						level = new Number(css.split("b-")[1][0]);
						element.removeClass("b-" + level);
						element.addClass("b-" + (level + 1));
						element.find("span").html(element.attr("class").replace("dark", ""));
					}
					box.removeClass("w-" + weight);
					box.addClass("w-" + (weight + 1));
					box.find("span").html(box.attr("class").replace("dark", ""));
				}
				
				function decrease(element) {
					box = button.parent().parent();
					css = box.attr("class");
					level = new Number(css.split("b-")[1][0]);
					if(css.indexOf("w-") != -1) {
						weight = new Number(css.split("w-")[1][0]);
					} else {
						weight = 1;
					}
					boxes = box.siblings();
					for(var i=0; i<boxes.length; i++) {
						element = $(boxes[i]);
						css = element.attr("class");
						level = new Number(css.split("b-")[1][0]);
						element.removeClass("b-" + level);
						element.addClass("b-" + (level - 1));
						element.find("span").html(element.attr("class").replace("dark", ""));
					}
					box.removeClass("w-" + weight);
					box.addClass("w-" + (weight - 1));
					box.find("span").html(box.attr("class").replace("dark", ""));
					
				}

				return that
			}

			function Buttons () {
				
				var that = htmlCanvas.widget();
				var classes = ['default', 'success', 'primary', 'warning', 'danger'];
				
				that.renderOn = function(html) {
					for(i in classes) {
						c = classes[i];
						panel = html.div().addClass('panel').asJQuery();
						html.span('<button class="' + c + '"></button>').asJQuery().appendTo(panel);
						html.button(c).addClass(c).asJQuery().appendTo(panel);
					}
				}
				
				return that
			}
	
			Header().appendTo($('body'));
			
			Browser().appendTo($('body'));	
	
		</script>
	</body>

</html>
